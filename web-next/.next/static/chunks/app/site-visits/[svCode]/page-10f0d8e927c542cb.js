(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[948],{85675:(e,t,r)=>{Promise.resolve().then(r.bind(r,82447))},76046:(e,t,r)=>{"use strict";var s=r(66658);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},82447:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>em,dynamic:()=>ec});var s=r(95155),a=r(12115),i=r(76046),n=r(39556),l=r(2293),o=r(93610),d=r(18166),c=r(18050),u=r(88068),m=r(67668),f=r(23360),p=r(41524),v=r(1488),h=r(4256),x="rovingFocusGroup.onEntryFocus",g={bubbles:!1,cancelable:!0},b="RovingFocusGroup",[_,j,y]=(0,c.N)(b),[w,N]=(0,d.A)(b,[y]),[k,S]=w(b),C=a.forwardRef((e,t)=>(0,s.jsx)(_.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,s.jsx)(_.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,s.jsx)(I,{...e,ref:t})})}));C.displayName=b;var I=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:i,loop:n=!1,dir:l,currentTabStopId:d,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:m,onEntryFocus:_,preventScrollOnEntryFocus:y=!1,...w}=e,N=a.useRef(null),S=(0,u.s)(t,N),C=(0,h.jH)(l),[I,D]=(0,v.i)({prop:d,defaultProp:null!=c?c:null,onChange:m,caller:b}),[R,A]=a.useState(!1),F=(0,p.c)(_),P=j(r),B=a.useRef(!1),[T,J]=a.useState(0);return a.useEffect(()=>{let e=N.current;if(e)return e.addEventListener(x,F),()=>e.removeEventListener(x,F)},[F]),(0,s.jsx)(k,{scope:r,orientation:i,dir:C,loop:n,currentTabStopId:I,onItemFocus:a.useCallback(e=>D(e),[D]),onItemShiftTab:a.useCallback(()=>A(!0),[]),onFocusableItemAdd:a.useCallback(()=>J(e=>e+1),[]),onFocusableItemRemove:a.useCallback(()=>J(e=>e-1),[]),children:(0,s.jsx)(f.sG.div,{tabIndex:R||0===T?-1:0,"data-orientation":i,...w,ref:S,style:{outline:"none",...e.style},onMouseDown:(0,o.mK)(e.onMouseDown,()=>{B.current=!0}),onFocus:(0,o.mK)(e.onFocus,e=>{let t=!B.current;if(e.target===e.currentTarget&&t&&!R){let t=new CustomEvent(x,g);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=P().filter(e=>e.focusable);E([e.find(e=>e.active),e.find(e=>e.id===I),...e].filter(Boolean).map(e=>e.ref.current),y)}}B.current=!1}),onBlur:(0,o.mK)(e.onBlur,()=>A(!1))})})}),D="RovingFocusGroupItem",R=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:i=!0,active:n=!1,tabStopId:l,children:d,...c}=e,u=(0,m.B)(),p=l||u,v=S(D,r),h=v.currentTabStopId===p,x=j(r),{onFocusableItemAdd:g,onFocusableItemRemove:b,currentTabStopId:y}=v;return a.useEffect(()=>{if(i)return g(),()=>b()},[i,g,b]),(0,s.jsx)(_.ItemSlot,{scope:r,id:p,focusable:i,active:n,children:(0,s.jsx)(f.sG.span,{tabIndex:h?0:-1,"data-orientation":v.orientation,...c,ref:t,onMouseDown:(0,o.mK)(e.onMouseDown,e=>{i?v.onItemFocus(p):e.preventDefault()}),onFocus:(0,o.mK)(e.onFocus,()=>v.onItemFocus(p)),onKeyDown:(0,o.mK)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){v.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,r){var s;let a=(s=e.key,"rtl"!==r?s:"ArrowLeft"===s?"ArrowRight":"ArrowRight"===s?"ArrowLeft":s);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(a))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)))return A[a]}(e,v.orientation,v.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let r=x().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)r.reverse();else if("prev"===t||"next"===t){"prev"===t&&r.reverse();let s=r.indexOf(e.currentTarget);r=v.loop?function(e,t){return e.map((r,s)=>e[(t+s)%e.length])}(r,s+1):r.slice(s+1)}setTimeout(()=>E(r))}}),children:"function"==typeof d?d({isCurrentTabStop:h,hasTabStop:null!=y}):d})})});R.displayName=D;var A={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.activeElement;for(let s of e)if(s===r||(s.focus({preventScroll:t}),document.activeElement!==r))return}var F=r(17028),P="Tabs",[B,T]=(0,d.A)(P,[N]),J=N(),[O,K]=B(P),q=a.forwardRef((e,t)=>{let{__scopeTabs:r,value:a,onValueChange:i,defaultValue:n,orientation:l="horizontal",dir:o,activationMode:d="automatic",...c}=e,u=(0,h.jH)(o),[p,x]=(0,v.i)({prop:a,onChange:i,defaultProp:null!=n?n:"",caller:P});return(0,s.jsx)(O,{scope:r,baseId:(0,m.B)(),value:p,onValueChange:x,orientation:l,dir:u,activationMode:d,children:(0,s.jsx)(f.sG.div,{dir:u,"data-orientation":l,...c,ref:t})})});q.displayName=P;var L="TabsList",M=a.forwardRef((e,t)=>{let{__scopeTabs:r,loop:a=!0,...i}=e,n=K(L,r),l=J(r);return(0,s.jsx)(C,{asChild:!0,...l,orientation:n.orientation,dir:n.dir,loop:a,children:(0,s.jsx)(f.sG.div,{role:"tablist","aria-orientation":n.orientation,...i,ref:t})})});M.displayName=L;var Z="TabsTrigger",U=a.forwardRef((e,t)=>{let{__scopeTabs:r,value:a,disabled:i=!1,...n}=e,l=K(Z,r),d=J(r),c=G(l.baseId,a),u=$(l.baseId,a),m=a===l.value;return(0,s.jsx)(R,{asChild:!0,...d,focusable:!i,active:m,children:(0,s.jsx)(f.sG.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":u,"data-state":m?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:c,...n,ref:t,onMouseDown:(0,o.mK)(e.onMouseDown,e=>{i||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(a)}),onKeyDown:(0,o.mK)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(a)}),onFocus:(0,o.mK)(e.onFocus,()=>{let e="manual"!==l.activationMode;m||i||!e||l.onValueChange(a)})})})});U.displayName=Z;var W="TabsContent",z=a.forwardRef((e,t)=>{let{__scopeTabs:r,value:i,forceMount:n,children:l,...o}=e,d=K(W,r),c=G(d.baseId,i),u=$(d.baseId,i),m=i===d.value,p=a.useRef(m);return a.useEffect(()=>{let e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,s.jsx)(F.C,{present:n||m,children:r=>{let{present:a}=r;return(0,s.jsx)(f.sG.div,{"data-state":m?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":c,hidden:!a,id:u,tabIndex:0,...o,ref:t,style:{...e.style,animationDuration:p.current?"0s":void 0},children:a&&l})}})});function G(e,t){return"".concat(e,"-trigger-").concat(t)}function $(e,t){return"".concat(e,"-content-").concat(t)}z.displayName=W;var V=r(21567);let H=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(M,{ref:t,className:(0,V.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a})});H.displayName=M.displayName;let Y=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(U,{ref:t,className:(0,V.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a})});Y.displayName=U.displayName;let X=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(z,{ref:t,className:(0,V.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});X.displayName=z.displayName;var Q=r(22130),ee=r(73312),et=r(33900),er=r(98986);let es=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("textarea",{className:(0,V.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});es.displayName="Textarea";var ea=r(30814),ei=r(54208);let en=(0,l.b)();function el(e){let{svId:t,onChanged:r}=e,[i,n]=(0,a.useState)([]),[l,o]=(0,a.useState)({});async function d(e,s){let a={...l,[e]:s};o(a),await en.from("site_visit_checklist_response").upsert({site_visit_id:t,checklist_item_code:e,response_option_code:s}),null==r||r(a)}return(0,a.useEffect)(()=>{(async()=>{let[{data:e},{data:s}]=await Promise.all([en.from("checklist_item").select("code,label").eq("is_active",!0),en.from("site_visit_checklist_response").select("checklist_item_code,response_option_code").eq("site_visit_id",t)]);n(e||[]);let a={};(s||[]).forEach(e=>{a[e.checklist_item_code]=e.response_option_code}),o(a),null==r||r(a)})()},[t]),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Prep checklist"}),(0,s.jsx)("div",{className:"space-y-2",children:i.map(e=>(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[(0,s.jsx)(er.J,{children:e.label}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,s.jsx)("input",{type:"radio",name:e.code,checked:"yes"===l[e.code],onChange:()=>d(e.code,"yes")})," Yes"]}),(0,s.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,s.jsx)("input",{type:"radio",name:e.code,checked:"no"===l[e.code],onChange:()=>d(e.code,"no")})," No"]}),(0,s.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,s.jsx)("input",{type:"radio",name:e.code,checked:"na"===l[e.code],onChange:()=>d(e.code,"na")})," N/A"]})]})]},e.code))})]})}let eo=(0,l.b)();function ed(e){let{siteVisitId:t}=e,[r,i]=(0,a.useState)(""),[n,l]=(0,a.useState)(""),[o,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{let{data:e}=await eo.from("site_visit_eba_snapshot").select("eba_id, document_url").eq("site_visit_id",t).maybeSingle();d(e),i((null==e?void 0:e.document_url)||""),l((null==e?void 0:e.eba_id)||"")})()},[t]);let c=async()=>{let{error:e}=await eo.from("site_visit_eba_snapshot").upsert({site_visit_id:t,eba_id:n||null,document_url:r||null});if(e)return ea.o.error(e.message);ea.o.success("EBA link saved")};return(0,s.jsxs)("div",{className:"space-y-2 p-3 rounded border",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"EBA quick attach"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"EBA record (optional)"}),(0,s.jsx)(et.p,{value:n,onChange:e=>l(e.target.value),placeholder:"company_eba_records.id"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Document URL"}),(0,s.jsx)(et.p,{value:r,onChange:e=>i(e.target.value),placeholder:"https://..."})]})]}),(0,s.jsx)(ee.$,{onClick:c,size:"sm",children:"Save EBA link"})]})}let ec="force-dynamic";function eu(e,t){return"sv:".concat(e,":draft:").concat(t)}function em(){let e=(0,l.b)(),t=(0,i.useParams)(),r=(null==t?void 0:t.svCode)||"",[o,d]=(0,a.useState)("prep"),{data:c,refetch:u}=(0,n.I)({queryKey:["site-visit",r],enabled:!!r,queryFn:async()=>{let{data:t,error:s}=await e.from("site_visit").select("id, employer_id, job_site_id, objective, estimated_workers_count, outcomes_locked, status_code, scheduled_at, started_at, completed_at").eq("sv_code",r).maybeSingle();if(s)throw s;return t}}),[m,f]=(0,a.useState)(""),[p,v]=(0,a.useState)(""),[h,x]=(0,a.useState)(""),[g,b]=(0,a.useState)(!1),[_,j]=(0,a.useState)(!1),[y,w]=(0,a.useState)({});(0,a.useEffect)(()=>{var e;c&&(f(c.objective||""),v(null!==(e=c.estimated_workers_count)&&void 0!==e?e:""),x(c.scheduled_at?new Date(c.scheduled_at).toISOString().slice(0,16):""))},[c]);let N=async()=>{var t;if(!c)return;if(h&&new Date(h).getTime()<Date.now()){ea.o.error("Scheduled time must be in the future");return}let{error:s}=await e.from("site_visit").update({objective:m,estimated_workers_count:""===p?null:Number(p),scheduled_at:h?new Date(h).toISOString():null}).eq("id",c.id);if(s)return ea.o.error(s.message);ea.o.success("Saved"),t=eu(r,"prep"),"undefined"!=typeof localStorage&&localStorage.removeItem(t)},k=async()=>{if(!c)return;b(!0);let{error:t}=await e.from("site_visit").update({status_code:"in_progress",started_at:new Date().toISOString()}).eq("id",c.id);if(b(!1),t)return ea.o.error(t.message);ea.o.success("Visit started"),u()},S=async()=>{if(!c)return;j(!0);let{error:t}=await e.from("site_visit").update({status_code:"completed",completed_at:new Date().toISOString(),outcomes_locked:!0}).eq("id",c.id);if(j(!1),t)return ea.o.error(t.message);ea.o.success("Visit completed"),u()},[C,I]=(0,a.useState)("3"),[D,R]=(0,a.useState)([]);(0,a.useEffect)(()=>{let{data:e}=function(e){try{let t="undefined"!=typeof localStorage?localStorage.getItem(e):null;if(!t)return{data:null};let r=JSON.parse(t);return{data:r.data,savedAt:r.savedAt}}catch(e){return{data:null}}}(eu(r,"prep"));if(e){var t;f(e.objective||""),v(null!==(t=e.estimatedWorkers)&&void 0!==t?t:"")}},[r]),(0,a.useEffect)(()=>{var e,t;e=eu(r,"prep"),t={objective:m,estimatedWorkers:p},"undefined"!=typeof localStorage&&localStorage.setItem(e,JSON.stringify({data:t,savedAt:Date.now()}))},[r,m,p]);let A=async()=>{if(!c)return;let{data:t,error:r}=await e.from("whs_assessment").upsert({site_visit_id:c.id,rating_code:C}).select("id").single();if(r)return ea.o.error(r.message);for(let r of D){if(!r.title)continue;let{error:s}=await e.from("whs_breach").insert({whs_assessment_id:t.id,title:r.title,notes:r.notes||null,rating_code:C});if(s)return ea.o.error(s.message)}ea.o.success("WHS saved"),R([])},[E,F]=(0,a.useState)({super_paid:!0,super_paid_to_fund:!0,redundancy_contributions_up_to_date:!0,wages_correct:!0,eba_allowances_correct:!0}),P=async()=>{if(!c)return;let{error:t}=await e.from("entitlements_audit").upsert({site_visit_id:c.id,...E}).select("id").single();if(t)return ea.o.error(t.message);ea.o.success("Entitlements saved")},[B,T]=(0,a.useState)(!1),[J,O]=(0,a.useState)(8),{data:K=[]}=(0,n.I)({queryKey:["delegate-role-types"],queryFn:async()=>{let{data:t,error:r}=await e.from("delegate_role_type").select("code,label");if(r)throw r;return t||[]}}),[L,M]=(0,a.useState)({});(0,a.useEffect)(()=>{let e={};K.forEach(t=>{e[t.code]=e[t.code]||"3"}),M(t=>({...e,...t}))},[K]);let Z=async()=>{if(!c)return;let{data:t,error:r}=await e.from("delegate_assessment").upsert({site_visit_id:c.id,present:B}).select("id").single();if(r)return ea.o.error(r.message);for(let r of Object.keys(L)){let s={role_type_code:r,rating_code:L[r]};await e.from("delegate_role_rating").upsert({delegate_assessment_id:t.id,...s})}ea.o.success("Delegate saved")},[U,W]=(0,a.useState)(null),[z,G]=(0,a.useState)("follow_up"),[$,V]=(0,a.useState)(""),en=async()=>{if(!c||!U)return;let t=crypto.randomUUID(),r={site_visit_id:c.id,worker_id:U,method_code:"in_person",outcome_code:z,follow_up_at:"follow_up"===z&&$?new Date($).toISOString():null,client_generated_id:t};if("follow_up"===z&&!$){ea.o.error("Follow-up date/time required for follow-up outcome");return}let{error:s}=await e.from("dd_conversion_attempt").insert(r);if(s)return ea.o.error(s.message);"converted"===z&&confirm("Mark worker membership as Direct Debit active now?")&&await e.from("worker_memberships").upsert({worker_id:U,payment_method:"direct_debit",dd_status:"active"}),ea.o.success("DD attempt saved"),W(null)},eo=(0,a.useMemo)(()=>{let e=y||{},t=t=>"yes"===e[t]||"na"===e[t];return t("roe_email_sent")&&t("worker_list_updated")},[y]);return c?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-4 text-sm text-muted-foreground",children:[(0,s.jsxs)("span",{className:"mr-3",children:["Status: ",(0,s.jsx)("strong",{children:c.status_code||"draft_prep"})]}),c.scheduled_at&&(0,s.jsxs)("span",{className:"mr-3",children:["Scheduled: ",new Date(c.scheduled_at).toLocaleString()]}),c.started_at&&(0,s.jsxs)("span",{className:"mr-3",children:["Started: ",new Date(c.started_at).toLocaleString()]}),c.completed_at&&(0,s.jsxs)("span",{children:["Completed: ",new Date(c.completed_at).toLocaleString()]})]}),(0,s.jsxs)(q,{value:o,onValueChange:d,children:[(0,s.jsxs)(H,{children:[(0,s.jsx)(Y,{value:"prep",children:"Prep"}),(0,s.jsx)(Y,{value:"outcome",children:"Outcome"}),(0,s.jsx)(Y,{value:"print",children:"Print"})]}),(0,s.jsx)(X,{value:"prep",children:(0,s.jsxs)(Q.Zp,{children:[(0,s.jsx)(Q.aR,{children:(0,s.jsx)(Q.ZB,{children:"Preparation"})}),(0,s.jsxs)(Q.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Objective"}),(0,s.jsx)(es,{value:m,onChange:e=>f(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Estimated workers"}),(0,s.jsx)(et.p,{type:"number",min:0,value:p,onChange:e=>v(""===e.target.value?"":Number(e.target.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Scheduled Date/Time"}),(0,s.jsx)(et.p,{type:"datetime-local",value:h,onChange:e=>x(e.target.value)})]})]}),(0,s.jsx)(el,{svId:c.id,onChanged:e=>w(e)}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,s.jsx)(ed,{siteVisitId:c.id})}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:gap-3",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(ee.$,{onClick:N,disabled:!!c.outcomes_locked,children:"Save"}),(0,s.jsx)(ee.$,{variant:"outline",onClick:k,disabled:!!c.outcomes_locked||"in_progress"===c.status_code||"completed"===c.status_code||g||!eo,children:"Start visit"}),(0,s.jsx)(ee.$,{variant:"outline",onClick:S,disabled:!!c.outcomes_locked||"in_progress"!==c.status_code||_,children:"Complete visit"})]}),!eo&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Complete ROE email and worker list refresh before starting."})]})]})]})}),(0,s.jsx)(X,{value:"outcome",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(Q.Zp,{children:[(0,s.jsx)(Q.aR,{children:(0,s.jsx)(Q.ZB,{children:"WHS"})}),(0,s.jsxs)(Q.Wu,{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Overall rating (1 worst, 5 best)"}),(0,s.jsx)("select",{className:"border rounded h-10 w-full px-2",value:C,onChange:e=>I(e.target.value),children:["1","2","3","4","5"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(er.J,{children:"Breaches"}),D.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(et.p,{placeholder:"Title",value:e.title,onChange:e=>R(r=>r.map((r,s)=>s===t?{...r,title:e.target.value}:r))}),(0,s.jsx)(et.p,{placeholder:"Notes",value:e.notes||"",onChange:e=>R(r=>r.map((r,s)=>s===t?{...r,notes:e.target.value}:r))})]},t)),(0,s.jsx)(ee.$,{variant:"outline",onClick:()=>R(e=>[...e,{title:""}]),children:"Add breach"})]}),(0,s.jsx)(ee.$,{onClick:A,disabled:!!c.outcomes_locked,children:"Save WHS"})]})]}),(0,s.jsxs)(Q.Zp,{children:[(0,s.jsx)(Q.aR,{children:(0,s.jsx)(Q.ZB,{children:"Entitlements"})}),(0,s.jsxs)(Q.Wu,{className:"space-y-2",children:[Object.entries(E).map(e=>{let[t,r]=e;return(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:e=>F(r=>({...r,[t]:e.target.checked}))}),(0,s.jsx)("span",{className:"capitalize",children:t.replace(/_/g," ")})]},t)}),(0,s.jsxs)("div",{className:"p-3 rounded border bg-muted/20 text-sm",children:[(0,s.jsx)("strong",{children:"CBUS checks"})," (placeholder): confirm super is paid, correct, and to CBUS. Attach evidence via Attachments."]}),(0,s.jsx)(ee.$,{onClick:P,disabled:!!c.outcomes_locked,children:"Save Entitlements"})]})]}),(0,s.jsxs)(Q.Zp,{children:[(0,s.jsx)(Q.aR,{children:(0,s.jsx)(Q.ZB,{children:"Delegate"})}),(0,s.jsxs)(Q.Wu,{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:B,onChange:e=>T(e.target.checked)}),(0,s.jsx)("span",{children:"Delegate present"})]}),(0,s.jsx)(er.J,{children:"Ratio score (10→1)"}),(0,s.jsx)(et.p,{type:"number",min:1,max:10,value:J,onChange:e=>O(Number(e.target.value))}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Role capabilities"}),K.map(e=>(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[(0,s.jsx)("div",{className:"text-sm",children:e.label}),(0,s.jsx)("select",{className:"border rounded h-10 w-full px-2",value:L[e.code]||"3",onChange:t=>M(r=>({...r,[e.code]:t.target.value})),children:["1","2","3","4","5"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]},e.code))]}),(0,s.jsx)(ee.$,{onClick:Z,disabled:!!c.outcomes_locked,children:"Save Delegate"})]})]}),(0,s.jsxs)(Q.Zp,{children:[(0,s.jsx)(Q.aR,{children:(0,s.jsx)(Q.ZB,{children:"Direct Debit"})}),(0,s.jsxs)(Q.Wu,{className:"space-y-3",children:[(0,s.jsx)(ei.M,{employerId:c.employer_id,value:U||"",onChange:e=>W(e)}),(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Outcome"}),(0,s.jsxs)("select",{className:"border rounded h-10 w-full px-2",value:z,onChange:e=>G(e.target.value),children:[(0,s.jsx)("option",{value:"converted",children:"Converted"}),(0,s.jsx)("option",{value:"already_on_dd",children:"Already on DD"}),(0,s.jsx)("option",{value:"follow_up",children:"Follow up"}),(0,s.jsx)("option",{value:"declined",children:"Declined"})]})]}),"follow_up"===z&&(0,s.jsxs)("div",{children:[(0,s.jsx)(er.J,{children:"Follow up at"}),(0,s.jsx)(et.p,{type:"datetime-local",value:$,onChange:e=>V(e.target.value)})]}),(0,s.jsx)(ee.$,{onClick:en,disabled:!U||!!c.outcomes_locked,children:"Save Attempt"})]})]})]})}),(0,s.jsx)(X,{value:"print",children:(0,s.jsx)(()=>(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)(Q.Zp,{children:[(0,s.jsx)(Q.aR,{children:(0,s.jsx)(Q.ZB,{children:"Print Pack Preview"})}),(0,s.jsxs)(Q.Wu,{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"A4, 12.7mm margins. Use your browser Print. QR and sv_code shown on footer."}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(ee.$,{onClick:()=>window.print(),children:"Print"})})]})]})}),{})})]})]}):(0,s.jsx)("div",{className:"p-6",children:"Loading..."})}},73312:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var s=r(95155),a=r(12115),i=r(12317),n=r(31027),l=r(21567);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:d=!1,...c}=e,u=d?i.DX:"button";return(0,s.jsx)(u,{className:(0,l.cn)(o({variant:a,size:n,className:r})),ref:t,...c})});d.displayName="Button"},22130:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>l});var s=r(95155),a=r(12115),i=r(21567);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});o.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},33900:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(95155),a=r(12115),i=r(21567);let n=a.forwardRef((e,t)=>{let{className:r,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},98986:(e,t,r)=>{"use strict";r.d(t,{J:()=>d});var s=r(95155),a=r(12115),i=r(46195),n=r(31027),l=r(21567);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(i.b,{ref:t,className:(0,l.cn)(o(),r),...a})});d.displayName=i.b.displayName},54208:(e,t,r)=>{"use strict";r.d(t,{M:()=>o});var s=r(95155),a=r(12115),i=r(2293),n=r(98986);let l=(0,i.b)();function o(e){let{employerId:t,value:r,onChange:i}=e,[o,d]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=!1;return(async()=>{if(!t)return;u(!0);let{data:r,error:s}=await l.from("workers").select("id, first_name, surname, worker_placements!inner(employer_id)").eq("worker_placements.employer_id",t).limit(500);e||(s||d((r||[]).map(e=>({id:e.id,first_name:e.first_name,surname:e.surname}))),u(!1))})(),()=>{e=!0}},[t]),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(n.J,{children:"Worker"}),(0,s.jsxs)("select",{className:"border rounded h-10 w-full px-2",value:r||"",onChange:e=>i(e.target.value),disabled:c||!t,children:[(0,s.jsx)("option",{value:"",children:"Select worker"}),o.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.first_name," ",e.surname]},e.id))]})]})}},2293:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});var s=r(51106),a=r(2818);function i(){let e=a.env.NEXT_PUBLIC_SUPABASE_URL||"https://jzuoawqxqmrsftbtjkzv.supabase.co",t=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6dW9hd3F4cW1yc2Z0YnRqa3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNjYwMDcsImV4cCI6MjA2OTk0MjAwN30.iOvn3b02CX_Dch4bWlJbzY6EYLbWrmwpM7sQgAqimd8";return(0,s.UU)(e,t)}},21567:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var s=r(43463),a=r(69795);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}},4256:(e,t,r)=>{"use strict";r.d(t,{jH:()=>i});var s=r(12115);r(95155);var a=s.createContext(void 0);function i(e){let t=s.useContext(a);return e||t||"ltr"}},67668:(e,t,r)=>{"use strict";r.d(t,{B:()=>o});var s,a=r(12115),i=r(46611),n=(s||(s=r.t(a,2)))[" useId ".trim().toString()]||(()=>void 0),l=0;function o(e){let[t,r]=a.useState(n());return(0,i.N)(()=>{e||r(e=>e??String(l++))},[e]),e||(t?`radix-${t}`:"")}},46195:(e,t,r)=>{"use strict";r.d(t,{b:()=>l});var s=r(12115),a=r(23360),i=r(95155),n=s.forwardRef((e,t)=>(0,i.jsx)(a.sG.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var l=n}},e=>{var t=t=>e(e.s=t);e.O(0,[181,106,527,556,933,594,441,517,358],()=>t(85675)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[223],{11510:(e,t,r)=>{Promise.resolve().then(r.bind(r,40600))},40600:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>R,dynamic:()=>k});var l=r(95155),a=r(12115),s=r(39556),n=r(2293),i=r(22130),o=r(58581),c=r(27112),d=r(86354),u=r(21567);let m={light:"",dark:".dark"},h=a.createContext(null);function f(){let e=a.useContext(h);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let x=a.forwardRef((e,t)=>{let{id:r,className:s,children:n,config:i,...c}=e,d=a.useId(),m="chart-".concat(r||d.replace(/:/g,""));return(0,l.jsx)(h.Provider,{value:{config:i},children:(0,l.jsxs)("div",{"data-chart":m,ref:t,className:(0,u.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",s),...c,children:[(0,l.jsx)(v,{id:m,config:i}),(0,l.jsx)(o.u,{children:n})]})})});x.displayName="Chart";let v=e=>{let{id:t,config:r}=e,a=Object.entries(r).filter(e=>{let[t,r]=e;return r.theme||r.color});return a.length?(0,l.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(m).map(e=>{let[r,l]=e;return"\n".concat(l," [data-chart=").concat(t,"] {\n").concat(a.map(e=>{var t;let[l,a]=e,s=(null===(t=a.theme)||void 0===t?void 0:t[r])||a.color;return s?"  --color-".concat(l,": ").concat(s,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},p=c.m,j=a.forwardRef((e,t)=>{let{active:r,payload:s,className:n,indicator:i="dot",hideLabel:o=!1,hideIndicator:c=!1,label:d,labelFormatter:m,labelClassName:h,formatter:x,color:v,nameKey:p,labelKey:j}=e,{config:y}=f(),b=a.useMemo(()=>{var e;if(o||!(null==s?void 0:s.length))return null;let[t]=s,r="".concat(j||t.dataKey||t.name||"value"),a=g(y,t,r),n=j||"string"!=typeof d?null==a?void 0:a.label:(null===(e=y[d])||void 0===e?void 0:e.label)||d;return m?(0,l.jsx)("div",{className:(0,u.cn)("font-medium",h),children:m(n,s)}):n?(0,l.jsx)("div",{className:(0,u.cn)("font-medium",h),children:n}):null},[d,m,s,o,h,y,j]);if(!r||!(null==s?void 0:s.length))return null;let _=1===s.length&&"dot"!==i;return(0,l.jsxs)("div",{ref:t,className:(0,u.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[_?null:b,(0,l.jsx)("div",{className:"grid gap-1.5",children:s.map((e,t)=>{let r="".concat(p||e.name||e.dataKey||"value"),a=g(y,e,r),s=v||e.payload.fill||e.color;return(0,l.jsx)("div",{className:(0,u.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===i&&"items-center"),children:x&&(null==e?void 0:e.value)!==void 0&&e.name?x(e.value,e.name,e,t,e.payload):(0,l.jsxs)(l.Fragment,{children:[(null==a?void 0:a.icon)?(0,l.jsx)(a.icon,{}):!c&&(0,l.jsx)("div",{className:(0,u.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===i,"w-1":"line"===i,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===i,"my-0.5":_&&"dashed"===i}),style:{"--color-bg":s,"--color-border":s}}),(0,l.jsxs)("div",{className:(0,u.cn)("flex flex-1 justify-between leading-none",_?"items-end":"items-center"),children:[(0,l.jsxs)("div",{className:"grid gap-1.5",children:[_?b:null,(0,l.jsx)("span",{className:"text-muted-foreground",children:(null==a?void 0:a.label)||e.name})]}),e.value&&(0,l.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});function g(e,t,r){if("object"!=typeof t||null===t)return;let l="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,a=r;return r in t&&"string"==typeof t[r]?a=t[r]:l&&r in l&&"string"==typeof l[r]&&(a=l[r]),a in e?e[a]:e[r]}j.displayName="ChartTooltip",d.s,a.forwardRef((e,t)=>{let{className:r,hideIcon:a=!1,payload:s,verticalAlign:n="bottom",nameKey:i}=e,{config:o}=f();return(null==s?void 0:s.length)?(0,l.jsx)("div",{ref:t,className:(0,u.cn)("flex items-center justify-center gap-4","top"===n?"pb-3":"pt-3",r),children:s.map(e=>{let t="".concat(i||e.dataKey||"value"),r=g(o,e,t);return(0,l.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==r?void 0:r.icon)&&!a?(0,l.jsx)(r.icon,{}):(0,l.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),null==r?void 0:r.label]},e.value)})}):null}).displayName="ChartLegend";var y=r(28064),b=r(15255),_=r(12800),N=r(66963),w=r(14969);let k="force-dynamic",C=(0,n.b)();function R(){let{data:e=[]}=(0,s.I)({queryKey:["visit-outcomes"],queryFn:async()=>{let{data:e,error:t}=await C.from("visit_compliance_summary").select("site_visit_id, overall_score, classification_code").order("site_visit_id",{ascending:!1}).limit(200);if(t)throw t;return e||[]}}),{data:t=[]}=(0,s.I)({queryKey:["dd-funnel"],queryFn:async()=>{let{data:e,error:t}=await C.from("dd_conversion_attempt").select("outcome_code").limit(1e3);if(t)throw t;return e||[]}}),r=(0,a.useMemo)(()=>{let e=t.length,r=t.filter(e=>"converted"===e.outcome_code).length;return[{stage:"Attempts",value:e},{stage:"Follow up",value:t.filter(e=>"follow_up"===e.outcome_code).length},{stage:"Converted",value:r},{stage:"Declined",value:t.filter(e=>"declined"===e.outcome_code).length}]},[t]),{data:n=[]}=(0,s.I)({queryKey:["site-heat"],queryFn:async()=>{let{data:e,error:t}=await C.from("visit_compliance_summary").select("classification_code").limit(1e3);if(t)throw t;return e||[]}}),o=(0,a.useMemo)(()=>{let e={};for(let t of n)e[t.classification_code||"unknown"]=(e[t.classification_code||"unknown"]||0)+1;return Object.entries(e).map(e=>{let[t,r]=e;return{label:t,value:r}})},[n]);return(0,l.jsxs)("div",{className:"p-6 space-y-6",children:[(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsx)(i.ZB,{children:"Visit outcomes"})}),(0,l.jsx)(i.Wu,{children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"text-left p-2",children:"Visit"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Score"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Classification"})]})}),(0,l.jsx)("tbody",{children:e.map(e=>{var t,r,a;return(0,l.jsxs)("tr",{className:"border-t",children:[(0,l.jsx)("td",{className:"p-2",children:e.site_visit_id}),(0,l.jsx)("td",{className:"p-2",children:null!==(a=null===(r=e.overall_score)||void 0===r?void 0:null===(t=r.toFixed)||void 0===t?void 0:t.call(r,1))&&void 0!==a?a:"-"}),(0,l.jsx)("td",{className:"p-2",children:e.classification_code||"-"})]},e.site_visit_id)})})]})})})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsx)(i.ZB,{children:"DD conversion funnel"})}),(0,l.jsx)(i.Wu,{children:(0,l.jsx)(x,{config:{attempts:{label:"Attempts",color:"hsl(215 100% 50%)"}},children:(0,l.jsxs)(y.E,{data:r,children:[(0,l.jsx)(b.d,{vertical:!1}),(0,l.jsx)(_.W,{dataKey:"stage",tickLine:!1,axisLine:!1}),(0,l.jsx)(N.h,{allowDecimals:!1}),(0,l.jsx)(p,{content:(0,l.jsx)(j,{})}),(0,l.jsx)(w.y,{dataKey:"value",fill:"var(--color-attempts)",radius:[4,4,0,0]})]})})})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsx)(i.ZB,{children:"Compliance heatmap (by classification)"})}),(0,l.jsx)(i.Wu,{children:(0,l.jsx)(x,{config:{a:{color:"hsl(150 70% 40%)"},b:{color:"hsl(40 80% 50%)"},c:{color:"hsl(0 80% 50%)"}},children:(0,l.jsxs)(y.E,{data:o,children:[(0,l.jsx)(b.d,{vertical:!1}),(0,l.jsx)(_.W,{dataKey:"label",tickLine:!1,axisLine:!1}),(0,l.jsx)(N.h,{allowDecimals:!1}),(0,l.jsx)(p,{content:(0,l.jsx)(j,{})}),(0,l.jsx)(w.y,{dataKey:"value",fill:"var(--color-a)",radius:[4,4,0,0]})]})})})]})]})}},22130:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>i});var l=r(95155),a=r(12115),s=r(21567);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,l.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});o.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,l.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},2293:(e,t,r)=>{"use strict";r.d(t,{b:()=>a});var l=r(51106);function a(){return(0,l.UU)("http://localhost","dev")}},21567:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var l=r(43463),a=r(69795);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,l.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[106,181,527,556,570,441,517,358],()=>t(11510)),_N_E=e.O()}]);
(()=>{var e={};e.id=948,e.ids=[948],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},33873:e=>{"use strict";e.exports=require("path")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},79551:e=>{"use strict";e.exports=require("url")},74075:e=>{"use strict";e.exports=require("zlib")},68146:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=s(70260),a=s(28203),i=s(25155),n=s.n(i),o=s(67292),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let d=["",{children:["site-visits",{children:["[svCode]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,48219)),"/workspace/web-next/src/app/site-visits/[svCode]/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,93607)),"/workspace/web-next/src/app/site-visits/layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,31977)),"/workspace/web-next/src/app/site-visits/loading.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,71354)),"/workspace/web-next/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"]}],c=["/workspace/web-next/src/app/site-visits/[svCode]/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/site-visits/[svCode]/page",pathname:"/site-visits/[svCode]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},68877:(e,t,s)=>{Promise.resolve().then(s.bind(s,48219))},66669:(e,t,s)=>{Promise.resolve().then(s.bind(s,33556))},96487:()=>{},78335:()=>{},79334:(e,t,s)=>{"use strict";var r=s(58686);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},33556:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eu,dynamic:()=>ec});var r=s(45512),a=s(58009),i=s(79334),n=s(33115),o=s(62895),l=s(31412),d=s(6004),c=s(39217),u=s(29952),p=s(30096),m=s(30830),f=s(92828),v=s(13024),x=s(59018),h="rovingFocusGroup.onEntryFocus",g={bubbles:!1,cancelable:!0},b="RovingFocusGroup",[j,_,w]=(0,c.N)(b),[y,N]=(0,d.A)(b,[w]),[k,C]=y(b),S=a.forwardRef((e,t)=>(0,r.jsx)(j.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,r.jsx)(j.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,r.jsx)(R,{...e,ref:t})})}));S.displayName=b;var R=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:s,orientation:i,loop:n=!1,dir:o,currentTabStopId:d,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:p,onEntryFocus:j,preventScrollOnEntryFocus:w=!1,...y}=e,N=a.useRef(null),C=(0,u.s)(t,N),S=(0,x.jH)(o),[R,D]=(0,v.i)({prop:d,defaultProp:c??null,onChange:p,caller:b}),[P,A]=a.useState(!1),F=(0,f.c)(j),E=_(s),q=a.useRef(!1),[K,T]=a.useState(0);return a.useEffect(()=>{let e=N.current;if(e)return e.addEventListener(h,F),()=>e.removeEventListener(h,F)},[F]),(0,r.jsx)(k,{scope:s,orientation:i,dir:S,loop:n,currentTabStopId:R,onItemFocus:a.useCallback(e=>D(e),[D]),onItemShiftTab:a.useCallback(()=>A(!0),[]),onFocusableItemAdd:a.useCallback(()=>T(e=>e+1),[]),onFocusableItemRemove:a.useCallback(()=>T(e=>e-1),[]),children:(0,r.jsx)(m.sG.div,{tabIndex:P||0===K?-1:0,"data-orientation":i,...y,ref:C,style:{outline:"none",...e.style},onMouseDown:(0,l.mK)(e.onMouseDown,()=>{q.current=!0}),onFocus:(0,l.mK)(e.onFocus,e=>{let t=!q.current;if(e.target===e.currentTarget&&t&&!P){let t=new CustomEvent(h,g);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=E().filter(e=>e.focusable);I([e.find(e=>e.active),e.find(e=>e.id===R),...e].filter(Boolean).map(e=>e.ref.current),w)}}q.current=!1}),onBlur:(0,l.mK)(e.onBlur,()=>A(!1))})})}),D="RovingFocusGroupItem",P=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:s,focusable:i=!0,active:n=!1,tabStopId:o,children:d,...c}=e,u=(0,p.B)(),f=o||u,v=C(D,s),x=v.currentTabStopId===f,h=_(s),{onFocusableItemAdd:g,onFocusableItemRemove:b,currentTabStopId:w}=v;return a.useEffect(()=>{if(i)return g(),()=>b()},[i,g,b]),(0,r.jsx)(j.ItemSlot,{scope:s,id:f,focusable:i,active:n,children:(0,r.jsx)(m.sG.span,{tabIndex:x?0:-1,"data-orientation":v.orientation,...c,ref:t,onMouseDown:(0,l.mK)(e.onMouseDown,e=>{i?v.onItemFocus(f):e.preventDefault()}),onFocus:(0,l.mK)(e.onFocus,()=>v.onItemFocus(f)),onKeyDown:(0,l.mK)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){v.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,s){var r;let a=(r=e.key,"rtl"!==s?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(a))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)))return A[a]}(e,v.orientation,v.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let s=h().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)s.reverse();else if("prev"===t||"next"===t){"prev"===t&&s.reverse();let r=s.indexOf(e.currentTarget);s=v.loop?function(e,t){return e.map((s,r)=>e[(t+r)%e.length])}(s,r+1):s.slice(r+1)}setTimeout(()=>I(s))}}),children:"function"==typeof d?d({isCurrentTabStop:x,hasTabStop:null!=w}):d})})});P.displayName=D;var A={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function I(e,t=!1){let s=document.activeElement;for(let r of e)if(r===s||(r.focus({preventScroll:t}),document.activeElement!==s))return}var F=s(98060),E="Tabs",[q,K]=(0,d.A)(E,[N]),T=N(),[B,$]=q(E),G=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:a,onValueChange:i,defaultValue:n,orientation:o="horizontal",dir:l,activationMode:d="automatic",...c}=e,u=(0,x.jH)(l),[f,h]=(0,v.i)({prop:a,onChange:i,defaultProp:n??"",caller:E});return(0,r.jsx)(B,{scope:s,baseId:(0,p.B)(),value:f,onValueChange:h,orientation:o,dir:u,activationMode:d,children:(0,r.jsx)(m.sG.div,{dir:u,"data-orientation":o,...c,ref:t})})});G.displayName=E;var M="TabsList",L=a.forwardRef((e,t)=>{let{__scopeTabs:s,loop:a=!0,...i}=e,n=$(M,s),o=T(s);return(0,r.jsx)(S,{asChild:!0,...o,orientation:n.orientation,dir:n.dir,loop:a,children:(0,r.jsx)(m.sG.div,{role:"tablist","aria-orientation":n.orientation,...i,ref:t})})});L.displayName=M;var Z="TabsTrigger",J=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:a,disabled:i=!1,...n}=e,o=$(Z,s),d=T(s),c=W(o.baseId,a),u=V(o.baseId,a),p=a===o.value;return(0,r.jsx)(P,{asChild:!0,...d,focusable:!i,active:p,children:(0,r.jsx)(m.sG.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":u,"data-state":p?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:c,...n,ref:t,onMouseDown:(0,l.mK)(e.onMouseDown,e=>{i||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(a)}),onKeyDown:(0,l.mK)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(a)}),onFocus:(0,l.mK)(e.onFocus,()=>{let e="manual"!==o.activationMode;p||i||!e||o.onValueChange(a)})})})});J.displayName=Z;var O="TabsContent",U=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:i,forceMount:n,children:o,...l}=e,d=$(O,s),c=W(d.baseId,i),u=V(d.baseId,i),p=i===d.value,f=a.useRef(p);return a.useEffect(()=>{let e=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,r.jsx)(F.C,{present:n||p,children:({present:s})=>(0,r.jsx)(m.sG.div,{"data-state":p?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":c,hidden:!s,id:u,tabIndex:0,...l,ref:t,style:{...e.style,animationDuration:f.current?"0s":void 0},children:s&&o})})});function W(e,t){return`${e}-trigger-${t}`}function V(e,t){return`${e}-content-${t}`}U.displayName=O;var z=s(44195);let H=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(L,{ref:s,className:(0,z.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));H.displayName=L.displayName;let X=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(J,{ref:s,className:(0,z.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));X.displayName=J.displayName;let Q=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(U,{ref:s,className:(0,z.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Q.displayName=U.displayName;var Y=s(64590),ee=s(39400),et=s(77722),es=s(52628);let er=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("textarea",{className:(0,z.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));er.displayName="Textarea";var ea=s(91542),ei=s(55992);let en=(0,o.b)();function eo({svId:e,onChanged:t}){let[s,i]=(0,a.useState)([]),[n,o]=(0,a.useState)({});async function l(s,r){let a={...n,[s]:r};o(a),await en.from("site_visit_checklist_response").upsert({site_visit_id:e,checklist_item_code:s,response_option_code:r}),t?.(a)}return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"Prep checklist"}),(0,r.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[(0,r.jsx)(es.J,{children:e.label}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,r.jsx)("input",{type:"radio",name:e.code,checked:"yes"===n[e.code],onChange:()=>l(e.code,"yes")})," Yes"]}),(0,r.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,r.jsx)("input",{type:"radio",name:e.code,checked:"no"===n[e.code],onChange:()=>l(e.code,"no")})," No"]}),(0,r.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,r.jsx)("input",{type:"radio",name:e.code,checked:"na"===n[e.code],onChange:()=>l(e.code,"na")})," N/A"]})]})]},e.code))})]})}let el=(0,o.b)();function ed({siteVisitId:e}){let[t,s]=(0,a.useState)(""),[i,n]=(0,a.useState)(""),[o,l]=(0,a.useState)(null),d=async()=>{let{error:s}=await el.from("site_visit_eba_snapshot").upsert({site_visit_id:e,eba_id:i||null,document_url:t||null});if(s)return ea.o.error(s.message);ea.o.success("EBA link saved")};return(0,r.jsxs)("div",{className:"space-y-2 p-3 rounded border",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"EBA quick attach"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"EBA record (optional)"}),(0,r.jsx)(et.p,{value:i,onChange:e=>n(e.target.value),placeholder:"company_eba_records.id"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Document URL"}),(0,r.jsx)(et.p,{value:t,onChange:e=>s(e.target.value),placeholder:"https://..."})]})]}),(0,r.jsx)(ee.$,{onClick:d,size:"sm",children:"Save EBA link"})]})}let ec="force-dynamic";function eu(){let e=(0,o.b)(),t=(0,i.useParams)(),s=t?.svCode||"",[l,d]=(0,a.useState)("prep"),{data:c,refetch:u}=(0,n.I)({queryKey:["site-visit",s],enabled:!!s,queryFn:async()=>{let{data:t,error:r}=await e.from("site_visit").select("id, employer_id, job_site_id, objective, estimated_workers_count, outcomes_locked, status_code, scheduled_at, started_at, completed_at").eq("sv_code",s).maybeSingle();if(r)throw r;return t}}),[p,m]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[x,h]=(0,a.useState)(""),[g,b]=(0,a.useState)(!1),[j,_]=(0,a.useState)(!1),[w,y]=(0,a.useState)({}),N=async()=>{var t;if(!c)return;if(x&&new Date(x).getTime()<Date.now()){ea.o.error("Scheduled time must be in the future");return}let{error:r}=await e.from("site_visit").update({objective:p,estimated_workers_count:""===f?null:Number(f),scheduled_at:x?new Date(x).toISOString():null}).eq("id",c.id);if(r)return ea.o.error(r.message);ea.o.success("Saved"),t=`sv:${s}:draft:prep`,"undefined"!=typeof localStorage&&localStorage.removeItem(t)},k=async()=>{if(!c)return;b(!0);let{error:t}=await e.from("site_visit").update({status_code:"in_progress",started_at:new Date().toISOString()}).eq("id",c.id);if(b(!1),t)return ea.o.error(t.message);ea.o.success("Visit started"),u()},C=async()=>{if(!c)return;_(!0);let{error:t}=await e.from("site_visit").update({status_code:"completed",completed_at:new Date().toISOString(),outcomes_locked:!0}).eq("id",c.id);if(_(!1),t)return ea.o.error(t.message);ea.o.success("Visit completed"),u()},[S,R]=(0,a.useState)("3"),[D,P]=(0,a.useState)([]),A=async()=>{if(!c)return;let{data:t,error:s}=await e.from("whs_assessment").upsert({site_visit_id:c.id,rating_code:S}).select("id").single();if(s)return ea.o.error(s.message);for(let s of D){if(!s.title)continue;let{error:r}=await e.from("whs_breach").insert({whs_assessment_id:t.id,title:s.title,notes:s.notes||null,rating_code:S});if(r)return ea.o.error(r.message)}ea.o.success("WHS saved"),P([])},[I,F]=(0,a.useState)({super_paid:!0,super_paid_to_fund:!0,redundancy_contributions_up_to_date:!0,wages_correct:!0,eba_allowances_correct:!0}),E=async()=>{if(!c)return;let{error:t}=await e.from("entitlements_audit").upsert({site_visit_id:c.id,...I}).select("id").single();if(t)return ea.o.error(t.message);ea.o.success("Entitlements saved")},[q,K]=(0,a.useState)(!1),[T,B]=(0,a.useState)(8),{data:$=[]}=(0,n.I)({queryKey:["delegate-role-types"],queryFn:async()=>{let{data:t,error:s}=await e.from("delegate_role_type").select("code,label");if(s)throw s;return t||[]}}),[M,L]=(0,a.useState)({}),Z=async()=>{if(!c)return;let{data:t,error:s}=await e.from("delegate_assessment").upsert({site_visit_id:c.id,present:q}).select("id").single();if(s)return ea.o.error(s.message);for(let s of Object.keys(M)){let r={role_type_code:s,rating_code:M[s]};await e.from("delegate_role_rating").upsert({delegate_assessment_id:t.id,...r})}ea.o.success("Delegate saved")},[J,O]=(0,a.useState)(null),[U,W]=(0,a.useState)("follow_up"),[V,z]=(0,a.useState)(""),en=async()=>{if(!c||!J)return;let t=crypto.randomUUID(),s={site_visit_id:c.id,worker_id:J,method_code:"in_person",outcome_code:U,follow_up_at:"follow_up"===U&&V?new Date(V).toISOString():null,client_generated_id:t};if("follow_up"===U&&!V){ea.o.error("Follow-up date/time required for follow-up outcome");return}let{error:r}=await e.from("dd_conversion_attempt").insert(s);if(r)return ea.o.error(r.message);"converted"===U&&confirm("Mark worker membership as Direct Debit active now?")&&await e.from("worker_memberships").upsert({worker_id:J,payment_method:"direct_debit",dd_status:"active"}),ea.o.success("DD attempt saved"),O(null)},el=(0,a.useMemo)(()=>{let e=w||{},t=t=>"yes"===e[t]||"na"===e[t];return t("roe_email_sent")&&t("worker_list_updated")},[w]);return c?(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-4 text-sm text-muted-foreground",children:[(0,r.jsxs)("span",{className:"mr-3",children:["Status: ",(0,r.jsx)("strong",{children:c.status_code||"draft_prep"})]}),c.scheduled_at&&(0,r.jsxs)("span",{className:"mr-3",children:["Scheduled: ",new Date(c.scheduled_at).toLocaleString()]}),c.started_at&&(0,r.jsxs)("span",{className:"mr-3",children:["Started: ",new Date(c.started_at).toLocaleString()]}),c.completed_at&&(0,r.jsxs)("span",{children:["Completed: ",new Date(c.completed_at).toLocaleString()]})]}),(0,r.jsxs)(G,{value:l,onValueChange:d,children:[(0,r.jsxs)(H,{children:[(0,r.jsx)(X,{value:"prep",children:"Prep"}),(0,r.jsx)(X,{value:"outcome",children:"Outcome"}),(0,r.jsx)(X,{value:"print",children:"Print"})]}),(0,r.jsx)(Q,{value:"prep",children:(0,r.jsxs)(Y.Zp,{children:[(0,r.jsx)(Y.aR,{children:(0,r.jsx)(Y.ZB,{children:"Preparation"})}),(0,r.jsxs)(Y.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Objective"}),(0,r.jsx)(er,{value:p,onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Estimated workers"}),(0,r.jsx)(et.p,{type:"number",min:0,value:f,onChange:e=>v(""===e.target.value?"":Number(e.target.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Scheduled Date/Time"}),(0,r.jsx)(et.p,{type:"datetime-local",value:x,onChange:e=>h(e.target.value)})]})]}),(0,r.jsx)(eo,{svId:c.id,onChanged:e=>y(e)}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,r.jsx)(ed,{siteVisitId:c.id})}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:gap-3",children:[(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(ee.$,{onClick:N,disabled:!!c.outcomes_locked,children:"Save"}),(0,r.jsx)(ee.$,{variant:"outline",onClick:k,disabled:!!c.outcomes_locked||"in_progress"===c.status_code||"completed"===c.status_code||g||!el,children:"Start visit"}),(0,r.jsx)(ee.$,{variant:"outline",onClick:C,disabled:!!c.outcomes_locked||"in_progress"!==c.status_code||j,children:"Complete visit"})]}),!el&&(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Complete ROE email and worker list refresh before starting."})]})]})]})}),(0,r.jsx)(Q,{value:"outcome",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(Y.Zp,{children:[(0,r.jsx)(Y.aR,{children:(0,r.jsx)(Y.ZB,{children:"WHS"})}),(0,r.jsxs)(Y.Wu,{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Overall rating (1 worst, 5 best)"}),(0,r.jsx)("select",{className:"border rounded h-10 w-full px-2",value:S,onChange:e=>R(e.target.value),children:["1","2","3","4","5"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(es.J,{children:"Breaches"}),D.map((e,t)=>(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)(et.p,{placeholder:"Title",value:e.title,onChange:e=>P(s=>s.map((s,r)=>r===t?{...s,title:e.target.value}:s))}),(0,r.jsx)(et.p,{placeholder:"Notes",value:e.notes||"",onChange:e=>P(s=>s.map((s,r)=>r===t?{...s,notes:e.target.value}:s))})]},t)),(0,r.jsx)(ee.$,{variant:"outline",onClick:()=>P(e=>[...e,{title:""}]),children:"Add breach"})]}),(0,r.jsx)(ee.$,{onClick:A,disabled:!!c.outcomes_locked,children:"Save WHS"})]})]}),(0,r.jsxs)(Y.Zp,{children:[(0,r.jsx)(Y.aR,{children:(0,r.jsx)(Y.ZB,{children:"Entitlements"})}),(0,r.jsxs)(Y.Wu,{className:"space-y-2",children:[Object.entries(I).map(([e,t])=>(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:t,onChange:t=>F(s=>({...s,[e]:t.target.checked}))}),(0,r.jsx)("span",{className:"capitalize",children:e.replace(/_/g," ")})]},e)),(0,r.jsxs)("div",{className:"p-3 rounded border bg-muted/20 text-sm",children:[(0,r.jsx)("strong",{children:"CBUS checks"})," (placeholder): confirm super is paid, correct, and to CBUS. Attach evidence via Attachments."]}),(0,r.jsx)(ee.$,{onClick:E,disabled:!!c.outcomes_locked,children:"Save Entitlements"})]})]}),(0,r.jsxs)(Y.Zp,{children:[(0,r.jsx)(Y.aR,{children:(0,r.jsx)(Y.ZB,{children:"Delegate"})}),(0,r.jsxs)(Y.Wu,{className:"space-y-3",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:q,onChange:e=>K(e.target.checked)}),(0,r.jsx)("span",{children:"Delegate present"})]}),(0,r.jsx)(es.J,{children:"Ratio score (10→1)"}),(0,r.jsx)(et.p,{type:"number",min:1,max:10,value:T,onChange:e=>B(Number(e.target.value))}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Role capabilities"}),$.map(e=>(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[(0,r.jsx)("div",{className:"text-sm",children:e.label}),(0,r.jsx)("select",{className:"border rounded h-10 w-full px-2",value:M[e.code]||"3",onChange:t=>L(s=>({...s,[e.code]:t.target.value})),children:["1","2","3","4","5"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]},e.code))]}),(0,r.jsx)(ee.$,{onClick:Z,disabled:!!c.outcomes_locked,children:"Save Delegate"})]})]}),(0,r.jsxs)(Y.Zp,{children:[(0,r.jsx)(Y.aR,{children:(0,r.jsx)(Y.ZB,{children:"Direct Debit"})}),(0,r.jsxs)(Y.Wu,{className:"space-y-3",children:[(0,r.jsx)(ei.M,{employerId:c.employer_id,value:J||"",onChange:e=>O(e)}),(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Outcome"}),(0,r.jsxs)("select",{className:"border rounded h-10 w-full px-2",value:U,onChange:e=>W(e.target.value),children:[(0,r.jsx)("option",{value:"converted",children:"Converted"}),(0,r.jsx)("option",{value:"already_on_dd",children:"Already on DD"}),(0,r.jsx)("option",{value:"follow_up",children:"Follow up"}),(0,r.jsx)("option",{value:"declined",children:"Declined"})]})]}),"follow_up"===U&&(0,r.jsxs)("div",{children:[(0,r.jsx)(es.J,{children:"Follow up at"}),(0,r.jsx)(et.p,{type:"datetime-local",value:V,onChange:e=>z(e.target.value)})]}),(0,r.jsx)(ee.$,{onClick:en,disabled:!J||!!c.outcomes_locked,children:"Save Attempt"})]})]})]})}),(0,r.jsx)(Q,{value:"print",children:(0,r.jsx)(()=>(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)(Y.Zp,{children:[(0,r.jsx)(Y.aR,{children:(0,r.jsx)(Y.ZB,{children:"Print Pack Preview"})}),(0,r.jsxs)(Y.Wu,{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"A4, 12.7mm margins. Use your browser Print. QR and sv_code shown on footer."}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(ee.$,{onClick:()=>window.print(),children:"Print"})})]})]})}),{})})]})]}):(0,r.jsx)("div",{className:"p-6",children:"Loading..."})}},39400:(e,t,s)=>{"use strict";s.d(t,{$:()=>d});var r=s(45512),a=s(58009),i=s(12705),n=s(21643),o=s(44195);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef(({className:e,variant:t,size:s,asChild:a=!1,...n},d)=>{let c=a?i.DX:"button";return(0,r.jsx)(c,{className:(0,o.cn)(l({variant:t,size:s,className:e})),ref:d,...n})});d.displayName="Button"},64590:(e,t,s)=>{"use strict";s.d(t,{Wu:()=>d,ZB:()=>l,Zp:()=>n,aR:()=>o});var r=s(45512),a=s(58009),i=s(44195);let n=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));n.displayName="Card";let o=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));o.displayName="CardHeader";let l=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));l.displayName="CardTitle",a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let d=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},77722:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var r=s(45512),a=s(58009),i=s(44195);let n=a.forwardRef(({className:e,type:t,...s},a)=>(0,r.jsx)("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...s}));n.displayName="Input"},52628:(e,t,s)=>{"use strict";s.d(t,{J:()=>d});var r=s(45512),a=s(58009),i=s(92405),n=s(21643),o=s(44195);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.b,{ref:s,className:(0,o.cn)(l(),e),...t}));d.displayName=i.b.displayName},55992:(e,t,s)=>{"use strict";s.d(t,{M:()=>o});var r=s(45512),a=s(58009),i=s(62895),n=s(52628);function o({employerId:e,value:t,onChange:s}){let[i,o]=(0,a.useState)([]),[l,d]=(0,a.useState)(!1);return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(n.J,{children:"Worker"}),(0,r.jsxs)("select",{className:"border rounded h-10 w-full px-2",value:t||"",onChange:e=>s(e.target.value),disabled:l||!e,children:[(0,r.jsx)("option",{value:"",children:"Select worker"}),i.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.first_name," ",e.surname]},e.id))]})]})}(0,i.b)()},62895:(e,t,s)=>{"use strict";s.d(t,{b:()=>a});var r=s(89979);function a(){return(0,r.UU)("http://localhost","dev")}},48219:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,dynamic:()=>a});var r=s(46760);let a=(0,r.registerClientReference)(function(){throw Error("Attempted to call dynamic() from the server but dynamic is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspace/web-next/src/app/site-visits/[svCode]/page.tsx","dynamic"),i=(0,r.registerClientReference)(function(){throw Error("Attempted to call the default export of \"/workspace/web-next/src/app/site-visits/[svCode]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspace/web-next/src/app/site-visits/[svCode]/page.tsx","default")},93607:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(62740);function a({children:e}){return(0,r.jsx)(r.Fragment,{children:e})}},31977:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(62740);function a(){return(0,r.jsx)("div",{className:"p-6",children:"Loading..."})}},59018:(e,t,s)=>{"use strict";s.d(t,{jH:()=>i});var r=s(58009);s(45512);var a=r.createContext(void 0);function i(e){let t=r.useContext(a);return e||t||"ltr"}},30096:(e,t,s)=>{"use strict";s.d(t,{B:()=>l});var r,a=s(58009),i=s(49397),n=(r||(r=s.t(a,2)))[" useId ".trim().toString()]||(()=>void 0),o=0;function l(e){let[t,s]=a.useState(n());return(0,i.N)(()=>{e||s(e=>e??String(o++))},[e]),e||(t?`radix-${t}`:"")}},92405:(e,t,s)=>{"use strict";s.d(t,{b:()=>o});var r=s(58009),a=s(30830),i=s(45512),n=r.forwardRef((e,t)=>(0,i.jsx)(a.sG.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var o=n}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[172,115,654],()=>s(68146));module.exports=r})();